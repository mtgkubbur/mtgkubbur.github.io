---
title: "Statistical Methods"
subtitle: "Time-Varying Bradley-Terry Model with Attendance-Based Mean Reversion and Cube Effects"
page-layout: article
toc: true
execute:
  echo: false
  warning: false
  message: false
---

## Overview

The ranking system uses a Bayesian Bradley-Terry model to estimate relative player strength from head-to-head match results. The model has three key components:

1. **Time-varying baseline strength** — Player skill evolves over time via an Ornstein-Uhlenbeck process
2. **Attendance-based mean reversion** — Players who show up maintain their ratings; absent players regress toward the mean
3. **Cube effects** — Players can be relatively stronger or weaker in specific cube formats

## The Bradley-Terry Model

For a match between player $i$ and player $j$, the probability that $i$ wins is:

$$
P(i \text{ wins}) = \text{logit}^{-1}(\alpha_i - \alpha_j) = \frac{\exp(\alpha_i - \alpha_j)}{1 + \exp(\alpha_i - \alpha_j)}
$$

where $\alpha_k$ is player $k$'s strength on the log-odds scale. When $\alpha_i = \alpha_j$, win probability is 50%. Each unit difference in $\alpha$ corresponds to odds ratio of $e^1 \approx 2.7$ in favor of the stronger player.

## Temporal Dynamics: Ornstein-Uhlenbeck Process

Player strength evolves over time according to an Ornstein-Uhlenbeck (OU) process that combines two forces:

1. **Random drift** — Strength can fluctuate due to practice, form changes, metagame shifts, etc.
2. **Mean reversion** — Strength gradually pulls back toward the population average

The evolution equation is:

$$
\alpha_{k,t} = \phi_k(t)^{\Delta t} \cdot \alpha_{k,t-1} + \sqrt{\Delta t} \cdot \sigma \cdot z_{k,t}
$$

where:

- $\Delta t$ is the time gap (in weeks) since the previous game night
- $\sigma$ is a shared volatility parameter
- $z_{k,t} \sim \text{Normal}(0, 1)$ are standardized innovations
- $\phi_k(t) \in [0, 1]$ is the mean-reversion rate, which depends on attendance

### Attendance-Based Mean Reversion

The key innovation is that the mean-reversion rate depends on whether a player attended:

$$
\phi_k(t) = \begin{cases}
\phi_{\text{present}} & \text{if player } k \text{ played at time } t \\
\phi_{\text{absent}} & \text{if player } k \text{ was absent}
\end{cases}
$$

where typically $\phi_{\text{present}} > \phi_{\text{absent}}$. This creates asymmetric dynamics:

- **Players who attend** maintain their ratings (weak mean reversion, $\phi \approx 1$)
- **Players who are absent** regress toward the mean faster (stronger mean reversion, smaller $\phi$)

This reflects the intuition that if you don't show up to prove yourself, the system should become more uncertain about your true current strength—and in the Bradley-Terry framework, increased uncertainty manifests as regression toward the mean.

### Half-Life Interpretation

The half-life tells us how long it takes for a player's "excess strength" (distance from the mean) to decay by 50%:

$$
t_{1/2} = -\frac{\ln(2)}{\ln(\phi)}
$$

For example, if $\phi_{\text{absent}} = 0.85$, the half-life is approximately 4 weeks. This means that if a strong player misses a month of cube nights, they lose about half of their rating advantage over the average player.

## Cube Effects

Some players are relatively stronger in certain cube formats (e.g., Vintage Cube vs. Pauper Cube). The model captures this with cube-specific effects $\gamma_{k,c}$:

$$
\eta_{ijc,t} = \alpha_{i,t} + \gamma_{i,c} - \alpha_{j,t} - \gamma_{j,c}
$$

where $\gamma_{k,c}$ represents player $k$'s relative strength in cube format $c$. The cube effects are constrained so that $\sum_c \gamma_{k,c} = 0$ for each player, ensuring that $\alpha_{k,t}$ represents average strength across all cube types.

Cube formats are categorized as:

| Category | Cubes |
|----------|-------|
| High | Vintage Cube, Bolti Vintage Cube, Nerva's Cube |
| Medium | Modern Cube, Synergy Cube, Bar Cube |
| Low | Khans Cube, Kaldheim Cube, Old Border Cube, Pauper Cube |
| Other | Miscellaneous cubes |

The cube effects are treated as static (not time-varying), which is reasonable since a player's relative affinity for different formats is unlikely to change dramatically week-to-week.

## Prior Distributions

The model uses the following priors:

| Parameter | Prior | Rationale |
|-----------|-------|-----------|
| $\alpha_0$ | $\text{Normal}(0, 1)$ | Initial strengths on log-odds scale |
| $\sigma$ | $\text{Exponential}(1)$ | Volatility; kept moderate |
| $\phi_{\text{present}}$ | $\text{Beta}(15, 1)$ | Concentrated near 1 (weak reversion) |
| $\phi_{\text{absent}}$ | $\text{Beta}(2, 2)$ | Symmetric, allows stronger reversion |
| $\gamma_{k,c}$ | $\text{Normal}(0, 0.3)$ | Small cube effects centered at zero |

The prior on $\phi_{\text{present}}$ being concentrated near 1 reflects the belief that players who consistently show up should maintain their ratings well. The prior on $\phi_{\text{absent}}$ is more diffuse, allowing the data to inform how quickly absent players should regress.

## Score Scale (0-100)

For interpretability, results are displayed on a normalized 0-100 scale rather than raw log-odds or traditional ELO. The normalization is performed **within each posterior draw**:

$$
\text{Score}_k = \frac{\alpha_k - \min_j(\alpha_j)}{\max_j(\alpha_j) - \min_j(\alpha_j)} \times 100
$$

This means:

- A score of **100** corresponds to the strongest player (in that posterior sample)
- A score of **0** corresponds to the weakest player (in that posterior sample)
- A score of **50** represents middle-of-the-pack performance

The advantage of this approach is that scores are always interpretable as "where does this player fall in the distribution of player skill?" regardless of the overall spread of abilities. With an Ornstein-Uhlenbeck mean-reversion process, traditional ELO scores would become compressed toward the mean, making differences harder to interpret.

### Uncertainty Propagation

Because normalization happens within each posterior draw, uncertainty is properly propagated:

- If there's high certainty about who's best, the top player's score distribution will be tightly concentrated near 100
- If two players are close in skill, both might have score distributions spanning 85-100, reflecting uncertainty about who's actually stronger

The reported score intervals (5th and 95th percentiles) capture this uncertainty. Overlapping intervals indicate that the ranking between those players is uncertain.

## Identifiability

The Bradley-Terry model has a location non-identifiability: we can add any constant to all $\alpha_k$ without changing the likelihood. We handle this by:

1. Constraining $\alpha_0$ (initial strengths) to sum to zero
2. Re-centering $\alpha_t$ after each time step to maintain the constraint

This ensures the mean player strength is always zero on the log-odds scale. The normalized 0-100 score transformation then maps this to an interpretable scale where relative position is clear.

## Inference

The model is fit using Hamiltonian Monte Carlo (HMC) via Stan, called from R using `cmdstanr`. Default settings:

- 4 chains
- 1,500 warmup iterations
- 3,000 sampling iterations
- `adapt_delta = 0.9` to reduce divergent transitions

The high dimensionality (player strengths at each time point plus cube effects) requires careful tuning, but the non-centered parameterization of the OU process helps with sampling efficiency.

## Model Comparison

The model includes generated quantities for leave-one-out cross-validation (LOO-CV) via the `loo` package. This allows comparison against simpler alternatives:

1. **Static Bradley-Terry** — No temporal dynamics
2. **OU without attendance effects** — Single $\phi$ for everyone
3. **No cube effects** — Only time-varying $\alpha$

## Limitations and Future Directions

**Current limitations:**

- Cube effects are static (don't evolve over time)
- No player-vs-player specific effects (some players might consistently beat others)
- Limited data per player can lead to high uncertainty
- The model doesn't distinguish between "hasn't played recently" and "new player"

**Potential extensions:**

- Glicko-style uncertainty inflation for inactive players (increase variance rather than shift mean)
- Separate ranking tables for different cube categories
- Time-varying cube effects
- Hierarchical priors on player-specific volatility
